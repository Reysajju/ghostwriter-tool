[build]
  # Build command for the entire project
  command = "npm install --legacy-peer-deps && cd client && npm install --legacy-peer-deps && npm run build && cd ../server && npm install --legacy-peer-deps && npm run build"
  
  # Directory to deploy (Next.js output)
  publish = "client/.next"
  
  # Functions directory for serverless functions
  functions = "server"

[build.environment]
  # Node version
  NODE_VERSION = "20"
  
  # Set to production for optimized builds
  NODE_ENV = "production"

# Rewrite rules for API calls
[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/:splat"
  status = 200

# Environment variables (set these in Netlify dashboard)
# NEXT_PUBLIC_SUPABASE_URL = your_supabase_url
# NEXT_PUBLIC_SUPABASE_ANON_KEY = your_supabase_anon_key
# SUPABASE_SERVICE_ROLE_KEY = your_service_role_key

[context.production]
  command = "npm install --legacy-peer-deps && cd client && npm install --legacy-peer-deps && npm run build && cd ../server && npm install --legacy-peer-deps && npm run build"

[context.preview]
  command = "npm install --legacy-peer-deps && cd client && npm install --legacy-peer-deps && npm run build && cd ../server && npm install --legacy-peer-deps && npm run build"

[context.deploy-preview]
  command = "npm install --legacy-peer-deps && cd client && npm install --legacy-peer-deps && npm run build && cd ../server && npm install --legacy-peer-deps && npm run build"
